---
title: __`r subgroup$agency_short` police solve only `r round(subgroup$rape_pct,0)`% of sexual assaults__
author: "A special report of the Police Accountability Project by ABC13."
output: html_document
---

```{css, echo=FALSE}
h1 {
  color: black;
  font-family: arial;
}
h2 {
  color: #001f4c;
  font-family: arial;
}
h3 {
  color: #C8490F;
  font-family: arial;
}
body {
  color: black;
  font-family: times, serif;
  font-size: 14pt;
}
h5 {
  color: white;
  background-color: #5397ff;
  font-family: arial;
  border-radius: 10px;
  padding: 1em;
  text-align: center;
}

```
<br>

Police in `r subgroup$agency_short` solved about `r round(subgroup$rape_pct,0)`% of sexual assaults reported in 2018`r ifelse(subgroup$rape_pct < 20, " - far less often than sexual assault cases are solved statewide,", ",")` according to ABC7's analysis of data from hundreds of California police departments.

The data show people in the `r subgroup$county` community reported `r prettyNum(subgroup$for_rape_sum, big.mark=",")` sexual assaults in 2018, and the police department said it closed `r subgroup$for_rape_clr_sum` of those cases with an arrest.

Statewide, police agencies cleared about `r round(statewide_rape,0)`% of sexual assaults.

Here's the share of sexual assaults solved year by year by `r subgroup$agency_short` police.

```{r, echo=FALSE, out.width='100%'}
library(plotly)
agencyclearance <- filter(clearance, ncic_code == agency)
fig <- plot_ly(agencyclearance, x = ~year, y = ~for_rape_sum, type = 'bar', name = 'Sexual assaults', marker=list(color = "#3fc1c9"))
fig <- fig %>% add_trace(y = ~for_rape_clr_sum, name = 'Cleared', marker=list(color = "#ffa500"))
fig <- fig %>% layout(yaxis = list(title = 'Number of crimes'), barmode = 'group')

fig
```

`r subgroup$agency_short` solved `r subgroup$violent_pct`% of the overall `r prettyNum(subgroup$violent_sum, big.mark=",")` violent crimes reported in 2018, according to the analysis of that every police agency reports annually to state justice officials. That also includes crimes like murder and aggravated assault.

Statewide, California police agencies solved about `r round(statewide_violent,0)`% of violent crimes.

Among other violent crimes, `r subgroup$agency_short` police reported solving `r subgroup$homicide_pct`% of homicides, `r subgroup$agg_assault_pct`% of aggravated assaults and `r subgroup$robbery_pct`% of robberies.

The agency has `r prettyNum(subgroup$police_sworn, big.mark=",")` sworn law enforcement officers on its staff and a budget of `r ifelse(subgroup$spending > 999999999, paste('$',round(subgroup$spending/1000000000,1),' billion',sep = ""), paste('$',round(subgroup$spending/1000000,1),' million',sep = ""))` in 2018, according to information drawn from state government justice and financial databases.

You can examine the sexual assault clearance rate among all departments across California in the interactive database below.

The chart shows the 2018 clearance rates for any department where at least 10 sexual assaults were reported during the year.

Among the police departments that received at least 100 sexual assault reports during 2018, only two - San Jose Police and San Bernardino County Sheriff's Department - solved fewer than 10% of the cases. Both solved about 9% of sexual assaults reported in 2018, the analysis found.

That's less than one-fourth the statewide rate of `r statewide_rape`%, the ABC analysis found.

Among those same larger communities, the highest clearance rate for sexual assault was the 76% reported by the Los Angeles County Sheriff's Department. 

In a small number of departments, the rate is above 100% because a small number of sexual assault cases from previous years were reported as being solved in 2018.

```{r, echo=FALSE, out.width='100%'}
library(reactable)
library(htmltools)
library(tidyverse)

reactable(
  clearance18 %>% select(3,6,24) %>% filter(for_rape_sum > 10),
  searchable=TRUE,
  defaultSorted = "for_rape_sum",
  columns = list(
    ncic_code = colDef(
      name = "Agency"#,
      #format = colFormat(prefix = "@")
    ),
    for_rape_sum = colDef(
      name = "Forcible Rapes",
      defaultSortOrder = "desc",
      cell = function(value) {
        width <- paste0(value * 100 / max(clearance18$for_rape_sum), "%")
        value <- format(value, big.mark = ",")
        # Fix each label using the width of the widest number (incl. thousands separators)
        value <- format(value, width = 9, justify = "right")
        bar_chart(value, width = width, fill = "#3fc1c9")
      },
      align = "left",
      # Use the operating system's default monospace font, and
      # preserve white space to prevent it from being collapsed by default
      style = list(fontFamily = "monospace", whiteSpace = "pre")
    ),
    rape_pct = colDef(
      name = "Percent Rapes Solved",
      # defaultSortOrder = "desc",
      cell = function(value) {
        value <- paste0(format(value, nsmall = 1), "%")
        # Fix width here to align single and double-digit percentages
        value <- format(value, width = 5, justify = "right")
        bar_chart(value, width = value, fill = "#ffa500", background = "#e1e1e1")
      },
      align = "left",
      style = list(fontFamily = "monospace", whiteSpace = "pre")
    )
  )
)
```
You can explore more of ABC Owned Television Stations' investigation of unsolved sexual assaults in California here.

## TESTING ONLY BELOW THIS POINT, IGNORE FOR NOW

Here's a quick look at a Flourish chart embedded within...

<div class="flourish-embed flourish-map" data-src="visualisation/4154506?174120"><script src="https://public.flourish.studio/resources/embed.js"></script></div>

Here's a quick look at an ABC OTV video embedded within...

<iframe width="500" height="300" src="https://abc7.com/video/embed/?pid=7762859" frameborder="0" allowfullscreen></iframe>

Here's a quick look at a You Tube video from FiveThirtyEight embedded within...

<iframe width="500" height="300" src="https://www.youtube.com/embed/3gBe0rVhpHE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


Here's a quick look at an image embedded from a URL within...

```{r, echo=FALSE}
# Define variable containing url
url <- "https://cdn.abcotvs.com/dip/images/7750200_110720-cc-ap-biden-kamala-sat-pm-img.jpg"
```
## Some presidential types
<center><img src="`r url`"></center>

Here's a quick look at a GIF animated image embedded within...

<center><img src="https://media4.giphy.com/media/j2pWZpr5RlpCodOB0d/giphy.gif"></center>

